@startuml
!theme plain
title Use Case: Physician Searching for Available Imaging Data

actor "Dr. Smith\n(Cardiologist)" as doctor
participant "EHR System" as ehr
participant "NVI API\n(Localization Service)" as nvi
participant "Hospital\nSystem" as dataholder
participant "Laboratory\nSystem" as laboratory

== Registering Care Provider Relationships ==
dataholder -> nvi: PUT /api\n{\n  pseudoBsn: <patient-id>,\n  zorgContext: "http://snomed.info/sct|371530004",\n  ura: "URA-HOSPITAL",\n  organizationType: "2.16.840.1.113883.2.4.15.1060|V4"\n}
note right of nvi
  Required authorization attributes for PUT:
  - URA: Organization identifier
  - OrganizationType: 2.16.840.1.113883.2.4.15.1060|V4 (Hospital)
end note
nvi -> dataholder: 201 Created

laboratory -> nvi: PUT /api\n{\n  pseudoBsn: <patient-id>,\n  zorgContext: "http://snomed.info/sct|371530004",\n  ura: "URA-LABORATORY",\n  organizationType: "2.16.840.1.113883.2.4.15.1060|L1"\n}
note right of nvi
  Required authorization attributes for PUT:
  - URA: Organization identifier
  - OrganizationType: 2.16.840.1.113883.2.4.15.1060|L1 (Laboratory)
end note
nvi -> laboratory: 201 Created

== Query NVI for Available Data ==
doctor -> ehr: Request imaging data\nfor patient
ehr -> nvi: GET /api?pseudoBsn=<patient-id>&\nzorgContext=http://snomed.info/sct|371530004
note right of nvi
  Required authorization attributes for GET:
  - URA: Requesting organization
  - OrganizationType: 2.16.840.1.113883.2.4.15.1060|V4 (Hospital)
  - UZI: Dr. Smith's identifier
  - Rolcode: Professional role code (e.g., specialist)

  Query parameters:
  - pseudoBsn: Patient identifier
  - zorgContext: Imaging report (371530004)
end note
nvi -> nvi: Validate authorization\nand search data locations

nvi -> ehr: Return response with datalocations:\n[\n  {created: "2024-02-20", ura: "URA-HOSPITAL", ...},\n  {created: "2024-02-25", ura: "URA-LABORATORY", ...}\n]

== Display Results ==
ehr -> doctor: Display available imaging sources:\n- Hospital (2024-02-20)\n- Laboratory (2024-02-25)

@enduml
