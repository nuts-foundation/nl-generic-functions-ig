@startuml localization-internist-registration

skinparam roundcorner 20
skinparam defaultFontName Arial 
hide footbox

!pragma teoz true

actor "Dr. Carter\n(Internist)" as doctor
participant "EHR @\n(Care Provider, URA:123)" as ehr
' participant "Pseudonymisation\nService" as pseudonymisation
participant "Localization Service" as nvi

doctor -> ehr: Register finding at first consult\n for patient\n (BSN:987654321)
ehr -> ehr: Create Encounter\n and Condition\n for patient
' ehr -> pseudonymisation: Request pseudoBsn for patient
' return pseudonym=3f5c8b2e9a1d4

note over nvi
  Required authorization attributes for POST:
  - Organization identifier (URA)
  ' Use of **pseudonymized** patient identifier 
  '  (pseudoBsn) is out of scope for this diagram
end note

ehr -> nvi: POST DocumentReference, containing:\n custodian: URA:123,\n patient: BSN:987654321,\n url: https://careprovider123.org/fhir/Patient/345fa-9076-9be4b"

nvi -> ehr: 201 Created

@enduml
